<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Wizard RP ‚Äî PDA Policial</title>
<style>
  :root{
    --bg:#071018; --muted:#98a8b0; --accent:#844ffc;
    --card:linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.01));
    --glass: rgba(255,255,255,0.05);
    --radius:12px;
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
  }
  body{margin:0;background:#03121a;color:#e7eef6}
  header{display:flex;align-items:center;justify-content:space-between;padding:12px;background:#041018}
  .brand{display:flex;align-items:center;gap:12px}
  .brand img{height:56px;border-radius:12px}
  .pill{background:rgba(255,255,255,0.08);padding:6px 12px;border-radius:999px;font-size:13px}
  .btn{background:var(--accent);border:none;padding:8px 12px;border-radius:8px;cursor:pointer;font-weight:700;color:#fff}
  .btn:hover{opacity:0.9}
  .btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.2);color:#ccc;padding:7px 12px;border-radius:8px;cursor:pointer}
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:14px;padding:20px}
  .card{background:var(--card);padding:18px;border-radius:12px;cursor:pointer;transition:.2s}
  .card:hover{transform:translateY(-4px);box-shadow:0 10px 30px rgba(0,0,0,.5)}
  .expanded{margin:20px;padding:18px;background:var(--card);border-radius:12px;min-height:400px}
  textarea,input{width:100%;margin-top:8px;padding:8px;border-radius:6px;background:#0b1a28;color:#fff;border:1px solid rgba(255,255,255,0.1)}
  .list{margin-top:12px;display:flex;flex-direction:column;gap:10px}
  .item{background:rgba(255,255,255,0.05);padding:10px;border-radius:8px;display:flex;justify-content:space-between;align-items:center}
  .overlay{position:fixed;inset:0;background:rgba(0,0,0,.7);display:flex;align-items:center;justify-content:center;z-index:1000}
  .modal{background:#061421;padding:18px;border-radius:12px;width:400px;max-width:90%}
</style>
</head>
<body>
  <header>
    <div class="brand">
      <img src="https://cdn.discordapp.com/attachments/1421898595271180360/1422217488145453219/LOGO_WIZARD_FONDO.png.png" alt="Wizard RP Logo">
      <div>
        <h2>Wizard RP ‚Äî PDA / CAD</h2>
        <div style="font-size:13px;color:#aaa">Conectado a Firestore</div>
      </div>
    </div>
    <div style="display:flex;gap:10px;align-items:center">
      <div id="userDisplay" class="pill">No conectado</div>
      <div id="dutyStatus" class="pill">Servicio: 0</div>
      <button id="btnLogin" class="btn-ghost">Iniciar</button>
    </div>
  </header>

  <section class="grid" id="cardsRoot"></section>
  <div id="expandedRoot"></div>

  <!-- Modal Login -->
  <div id="loginModal" class="overlay" style="display:none">
    <div class="modal">
      <h3>Entrar / Registrarse</h3>
      <input id="loginUser" placeholder="Usuario"/>
      <input id="loginPass" type="password" placeholder="Contrase√±a"/>
      <div style="margin-top:10px;display:flex;gap:8px">
        <button id="loginBtn" class="btn">Entrar</button>
        <button id="guestBtn" class="btn-ghost">Invitado</button>
        <button id="showReg" class="btn-ghost">Crear cuenta</button>
      </div>
      <div id="loginError" style="color:#f77;margin-top:8px;display:none"></div>
      <div id="registerBlock" style="display:none;margin-top:12px;border-top:1px solid rgba(255,255,255,.1);padding-top:12px">
        <h4>Crear cuenta</h4>
        <input id="regName" placeholder="Nombre visible"/>
        <input id="regUser" placeholder="Usuario"/>
        <input id="regPass" type="password" placeholder="Contrase√±a"/>
        <select id="regRole">
          <option value="officer">Oficial</option>
          <option value="dispatcher">Dispatcher</option>
          <option value="admin">Admin</option>
        </select>
        <button id="regCreate" class="btn" style="margin-top:10px">Crear</button>
        <div id="regMsg" style="margin-top:6px;font-size:13px;color:#aaa"></div>
      </div>
    </div>
  </div>

<script type="module">
/* ========== Firebase Config ========== */
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
import { getFirestore, collection, getDocs, addDoc, setDoc, doc, updateDoc, deleteDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "TU_API_KEY",
  authDomain: "TU_PROJECT_ID.firebaseapp.com",
  projectId: "TU_PROJECT_ID",
  storageBucket: "TU_PROJECT_ID.appspot.com",
  messagingSenderId: "XXX",
  appId: "XXX"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* ========== Estado ========== */
let currentUser = null;

/* ========== Tarjetas ========== */
const CARDS = [
  {id:'pda', title:'PDA', desc:'Buscar y crear fichas', icon:'üöì'},
  {id:'calls', title:'Llamadas', desc:'Gesti√≥n de alertas', icon:'üìû'},
  {id:'reports', title:'Informes', desc:'Crear y consultar', icon:'üìë'},
  {id:'fines', title:'Multas', desc:'Registrar sanciones', icon:'üí∏'},
  {id:'wanted', title:'Wanted', desc:'BOLO / Buscados', icon:'üö®'},
  {id:'admin', title:'Administraci√≥n', desc:'Roles y usuarios', icon:'‚öôÔ∏è'},
  {id:'logs', title:'Auditor√≠a', desc:'Historial de acciones', icon:'üìú'}
];
function renderCards(){
  const root=document.getElementById('cardsRoot'); root.innerHTML='';
  CARDS.forEach(c=>{
    const el=document.createElement('div'); el.className='card';
    el.innerHTML=`<h3>${c.icon} ${c.title}</h3><div>${c.desc}</div><button class="btn" style="margin-top:10px;background:#844ffc">Abrir</button>`;
    el.onclick=()=>openCard(c.id); root.appendChild(el);
  });
}

/* ========== Abrir m√≥dulos ========== */
function openCard(id){
  const root=document.getElementById('expandedRoot'); root.innerHTML='';
  const box=document.createElement('div'); box.className='expanded';
  if(id==='reports') renderReports(box);
  else if(id==='pda') renderPDA(box);
  else if(id==='calls') renderCalls(box);
  else if(id==='admin' && currentUser?.role==='admin') renderAdmin(box);
  else if(id==='logs' && currentUser?.role==='admin') renderLogs(box);
  else if(id==='fines') renderFines(box);
  else if(id==='wanted') renderWanted(box);
  root.appendChild(box);
}

/* ========== Ejemplo completo: Informes ========== */
function renderReports(c){
  c.innerHTML=`<h3>Informes</h3>
    <input id="repTitle" placeholder="T√≠tulo"/>
    <textarea id="repDesc" placeholder="Hechos y acciones..."></textarea>
    <button id="saveRep" class="btn" style="margin-top:8px">Guardar</button>
    <div id="reportsList" class="list"></div>`;
  document.getElementById('saveRep').onclick=async()=>{
    if(!currentUser){return alert("Debes iniciar sesi√≥n");}
    const t=document.getElementById('repTitle').value.trim();
    const d=document.getElementById('repDesc').value.trim();
    if(!t||!d) return alert("Faltan campos");
    await addDoc(collection(db,"reports"),{title:t,desc:d,author:currentUser.display,created:Date.now()});
  };
  onSnapshot(collection(db,"reports"),snap=>{
    const list=document.getElementById('reportsList'); list.innerHTML='';
    snap.forEach(docu=>{
      const r=docu.data();
      const div=document.createElement('div'); div.className='item';
      div.innerHTML=`<div><b>${r.title}</b><div style="font-size:13px;color:#aaa">${r.desc}</div></div><div>${r.author}</div>`;
      list.appendChild(div);
    });
  });
}

/* ========== Otros m√≥dulos (similares a informes, usando sus colecciones) ========== */
function renderPDA(c){ c.innerHTML=`<h3>PDA</h3><div style="color:#aaa">Colecci√≥n "pda"</div>`;}
function renderCalls(c){ c.innerHTML=`<h3>Llamadas</h3><div style="color:#aaa">Colecci√≥n "calls"</div>`;}
function renderFines(c){ c.innerHTML=`<h3>Multas</h3><div style="color:#aaa">Colecci√≥n "fines"</div>`;}
function renderWanted(c){ c.innerHTML=`<h3>Wanted</h3><div style="color:#aaa">Colecci√≥n "wanted"</div>`;}
function renderAdmin(c){ c.innerHTML=`<h3>Administraci√≥n</h3><div style="color:#aaa">Colecci√≥n "users" y "roles"</div>`;}
function renderLogs(c){ c.innerHTML=`<h3>Logs</h3><div style="color:#aaa">Colecci√≥n "logs"</div>`;}

/* ========== Login ========== */
document.getElementById('btnLogin').onclick=()=>{document.getElementById('loginModal').style.display='flex';};
document.getElementById('guestBtn').onclick=()=>{currentUser=null;document.getElementById('userDisplay').textContent="Invitado";document.getElementById('loginModal').style.display='none';};
document.getElementById('loginBtn').onclick=async()=>{
  const u=document.getElementById('loginUser').value.trim();
  const p=document.getElementById('loginPass').value.trim();
  const snap=await getDocs(collection(db,"users"));
  let found=null;
  snap.forEach(d=>{const user=d.data(); if(user.username===u && user.password===p) found=user;});
  if(found){currentUser=found;document.getElementById('userDisplay').textContent=`${found.display} (${found.role})`;document.getElementById('loginModal').style.display='none';}
  else {document.getElementById('loginError').style.display='block';document.getElementById('loginError').textContent="Usuario o contrase√±a incorrectos";}
};
document.getElementById('showReg').onclick=()=>{document.getElementById('registerBlock').style.display='block';};
document.getElementById('regCreate').onclick=async()=>{
  const name=document.getElementById('regName').value.trim();
  const user=document.getElementById('regUser').value.trim();
  const pass=document.getElementById('regPass').value.trim();
  const role=document.getElementById('regRole').value;
  if(!user||!pass){document.getElementById('regMsg').textContent="Usuario y contrase√±a obligatorios";return;}
  await addDoc(collection(db,"users"),{username:user,display:name||user,password:pass,role});
  document.getElementById('regMsg').textContent="Cuenta creada, ya puedes iniciar sesi√≥n.";
};

/* ========== Init ========== */
renderCards();
</script>
</body>
</html>
